= Galite Application Framework :  User guide
:toc: left
:toclevels: 4
:doctype: book
:source-highlighter: highlightjs
:favicon: ./images/logo_galite.png
:docinfo: shared

[preface]
Preface
-------
The Galite Project is a framework that lets you build business applications with few code. It's the successor of the https://github.com/kopiLeft/Kopi[Kopi project] which is a framework from the company DMS that allows the development of database applications using Java, JDBC, SWING and Vaadin 7.

Galite allows creating database applications in a high level specification language using Kotlin DSL and Exposed.

image::./images/galite-architecture.png[650,650]
:Galite architecture!:

The basic architecture of Visual Galite package is made of a three strongly independent parts:

- DSL: The DSL is the Kotlin functions provided for the user to develop an application.
- Model: The model layer is a set of model classes responsible for structuring and processing data. Also, it contains a high specification interfaces that any UI implementation should respect.
- UI: The UI is the presentation layer that represents the user interface. This can be extended to implement many technologies (web, mobile, desktop, etc.). For the moment Galite can generate a web application implemented in Vaadin flow (21+).

*Organization of This Document*

This documentation includes two main Chapters: +

* CHAPTER 1 : Getting Started

This chapter is intended to show how to configure the application and essential features to query the database.

* CHAPTER 2 : The Visual Galite application Framework

In this chapter, we will explore the capabilities of this framework.

== Getting Started

=== Entry point

Galite provides an entry point to the application that should be implemented to customize the application.

If you are creating a Vaadin application, you should implement the class `VApplication` and specify your application configurations by overriding the class properties:

[source,kotlin,highlight='7-9']
----
@Route("")
class MyApp : VApplication(Registry(domain = "GALITE", parent = null)) {

  override val sologanImage get() = "galite-slogan.png"

  override val logoImage get() = "galite-logo.png"

  override val logoHref get() = "http://[mywebsite]"

  override val alternateLocale get() = Locale("de", "AT")

  override val supportedLocales get() = arrayOf(Locale.FRANCE, Locale("de", "AT"), Locale("ar", "TN"))

  companion object {
    init {
      ApplicationConfiguration.setConfiguration(ConfigurationManager)
    }
  }

  object ConfigurationManager : ApplicationConfiguration() {
    override val version get(): String = "1.0"
    override val applicationName get(): String = "MyApp"
    override val informationText get(): String = "info"
    override val logFile get(): String = "log.txt"
    override val debugMailRecipient get(): String = "mail@adress"
    override fun getSMTPServer(): String = "smtp.server"
    override val faxServer get(): String = "fax.server"
    override fun mailErrors(): Boolean = false
    override fun logErrors(): Boolean = true
    override fun debugMessageInTransaction(): Boolean = true

    // And many other configurations. See ApplicationConfiguration.kt
  }
}
----

The `Route` annotation allows you to define the navigation URL of your web application.

=== Galite standard tables

There is a list of standard database tables used by Galite inorder to manage application modules and users. you may create these tables in your first database migration.

The definition of these tables is in the file https://github.com/kopiLeft/Galite/blob/master/galite-core/src/main/kotlin/org/kopi/galite/visual/db/DBSchema.kt[DBSchema.kt]. You can use Exposed to create these tables using `SchemaUtils.create(table)`.

This is the role of every table:

- *MODULE*: This table contains the modules of our application.

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|ID
|integer
|Table identifier

|UC
|integer
|Number of changes applied on the current row.

|TS
|integer
|Timestamp of last changes on the current row.

|KURZNAME
|varchar(25)
|The short name of this module.

|VATER
|integer
|The ID of the parent of this module, if our module is a form we put here the menu id of this form.

|QUELLE
|varchar(255)
|The source name of the module.

|PRIORITAET
|integer
|The priority of the module compared to another module. Example module with priority 10 is placed before the module of priority 20 in the same menu.

|OBJEKT
|varchar(255)
|The object name or the class name that contains the code of this module.

|SYMBOL
|integer
|The icon of this module.
|===

- *BENUTZERRECHTE*: The table `User Rights` displays the modules that each user is allowed to use.

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|ID
|integer
|Table identifier.

|TS
|integer
|Timestamp of last changes on the current row.

|BENUTZER
|integer
|The user id

|MODUL
|integer
|The module id.

|ZUGRIFF
|bool
|The access value.
|===

- *GRUPPENRECHTE*: This table displays the modules that each group of users is allowed to use.

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|ID
|integer
|Table identifier.

|TS
|integer
|Timestamp of last changes on the current row.

|GRUPPE
|integer
|The group id.

|MODUL
|integer
|The module id.

|ZUGRIFF
|bool
|The access value.
|===

- *GRUPPENZUGEHOERIGKEITEN*: This table contains the groups that each user belongs to. Each user can belong to many groups.

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|ID
|integer
|Table identifier.

|TS
|integer
|Timestamp of last changes on the current row.

|BENUTZER
|integer
|The user id.

|MODUL
|integer
|The module id.

|ZUGRIFF
|bool
|The access value.
|===

- *SYMBOLE*: This table store the icons for each module.

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|ID
|integer
|Table identifier.

|TS
|integer
|Timestamp of last changes on the current row.

|KURZNAME
|varchar(20)
|The short name of this icon.

|BEZEICHNUNG
|varchar(50)
|The description of this icon.

|OBJEKT
|varchar(50)
|This column present the icon of the module.
|===

- *FAVORITEN*: This table contains favorite modules for each user.

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|ID
|integer
|Table identifier.

|TS
|integer
|Timestamp of last changes on the current row.

|BENUTZER
|integer
|The user id.

|MODUL
|integer
|The module id.
|===

- *KOPI_USERS*: This table contains information about the users who use this application

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|ID
|integer
|Table identifier.

|UC
|integer
|Number of changes applied on the current row.

|TS
|integer
|Timestamp of last changes on the current row.

|KURZNAME
|varchar(10)
|The short name of the user.

|NAME
|varchar(50)
|The name of the user.

|ZEICHEN
|varchar(10)
|The type of the user.

|TELEFON
|varchar(20)
|The phone number of the user.

|EMAIL
|varchar(40)
|The email of the user.

|AKTIV
|bool
|is this user active?

|ERSTELLTVON
|timestamp
|Creation date of this user.

|ERSTELLTAM
|integer
|Created by.

|GEAENDERTAM
|timestamp
|The date of the change for this user.

|ERSTELLTAM
|integer
|Changed by.
|===

- *GRUPPEN*: This table contains the names of the groups

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|ID
|integer
|Table identifier.

|TS
|integer
|Timestamp of last changes on the current row.

|KURZNAME
|varchar(10)
|The short name of the group.

|BEZEICHNUNG
|varchar(40)
|The short description of the group.
|===

- *DUMMY*: This table is for database sequences

[cols="3*"]
[%header]
[%autowidth]
|===
|Column
|Type
|Description

|dummy
|char(1)
|Table identifier.
|===

=== Transactions

Every SQL statements should be executed within transaction. This allows to re-execute statements interrupted by deadlock (after asking the user if he wants to) or abort a whole transaction if something is wrong (like if a Java exception is thrown). The syntax is:

[source,kotlin]
----
transaction("an optional message") {
  ...
  ... // a list of Exposed queries
  ...
}
----

In a visual context, the optional message allows to inform the user that the transaction is being processed. For example: Showing a dialog containing a spinner with the message (For example: "Inserting the record..." or "Loading...", etc..).

=== The new Types

Galite introduces 2 types to the basic types available in the Kotlin language :

 * Month     : Years months values.
 * Week      : Years weeks values.

== Galite application framework

The visual Galite Framework is an application framework using the Kotlin DSL in order to create database applications easily.
In this chapter we will see how to create Galite powered forms, reports and charts.

include::general.adoc[]
include::form.adoc[]
include::report.adoc[]
include::chart.adoc[]
include::conclusion.adoc[]
